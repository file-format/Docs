{
  "date" : "2020-11-11",
  "keywords" :[ "BAK", "розширення", "файл", "формат файлу", "Тип файлу BAK", "Розширення файлу BAK", "Тип файлу бази даних", "Формат файлу бази даних", "Файли бази даних" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"Дізнайтеся про формат файлу BAK та API, які можуть створювати та відкривати файли BAK.",
  "title" :"Формат файлу BAK - файл резервної копії бази даних",
  "linktitle" : "BAK",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-12-04"
}

## Що таке файл BAK?

Файл із розширенням .bak зазвичай є файлом резервної копії, який використовується різними програмними засобами для зберігання резервних копій даних. З точки зору бази даних, файл BAK використовується Microsoft SQL Server для зберігання вмісту бази даних. Усі дані та файли, пов’язані з базою даних, зберігаються в цьому форматі файлу, щоб їх можна було отримати, якщо база даних може бути пошкоджена або недійсна з будь-якої причини. З метою безпеки файли резервних копій можна зберігати та індексувати на інших серверах. Кілька програм можуть створювати файли BAK, наприклад SQL Server Management Studio, Transact-SQL і Windows PowerShell.

## Формат файлу BAK

Внутрішні деталі файлу BAK невідомі, але широко припускають, що він заснований на форматі стрічки Microsoft (MTF). Доступні специфікації MTF, на які можна посилатися, щоб зрозуміти структуру файлу. У цьому документі міститься інформація про сховище MTF для всіх, хто має загальні знання про операції керування сховищами, стрічкові накопичувачі та файлові системи.

### Набори даних

Набір даних — це сукупність об’єктів, записаних на носій (стрічка, оптичний диск тощо) під час резервного копіювання або відновлення даних. Набори даних складаються з кількох носіїв у разі великого обсягу даних.

### Фундаментальні елементи MTF

Файл MTF складається з деяких основних елементів, які є його будівельними блоками. Ці елементи:

#### Блоки дескрипторів

Блоки дескрипторів (DBLK) використовуються для керування форматом і є основною основою файлу MTF. Один файл MTF визначає кілька DBLK для кожної унікальної ролі. Кожен DBLK — це блок даних змінної довжини, який розділений на такі чотири частини:

* `Загальний заголовок блоку` - структура фіксованої довжини, спільна для всіх DBLK. Це єдиний потрібний заголовок блоку.
* `Інформація про тип DBLK` - блок фіксованої довжини, специфічний для типу DBLK, який визначається
* «Дані операційної системи» – конкретні дані, визначені на основі типу DBLK і операційних систем
* `Інформація DBLK` – специфічна інформація DBLK змінної довжини, яку неможливо зберегти з інформацією DBLK фіксованої довжини.

 {{< figure src="../bak.png" alt="Формат файлу резервної копії Microsoft SQL" >}}

#### Потік даних

Потоки даних у файлі MTF використовуються для інкапсуляції та вирівнювання даних. Він складається із заголовка потоку, за яким слідують дані потоку. Заголовок потоку може інкапсулювати лише один тип даних потоку.

{{< figure src="../bak_datastream.png" alt="Формат файлу резервної копії Microsoft SQL" >}}

#### FileMarks

Позначка файлу використовується для логічного розділення та швидкого доступу до носія. Файлові позначки емулюються драйвером пристрою або за допомогою блоку програмного дескриптора файлових позначок, якщо пристрій, що використовується, не надає файлових позначок.

## Посилання ##

* [[MS-BCP]: формат масового копіювання](https://learn.microsoft.com/en-us/openspecs/sql_data_portability/ms-bcp/54965c4d-34c7-400d-b970-1007984315a5)

