{
  "date" : "2020-11-11",
  "keywords" :[ "BAK", "拡張子", "ファイル", "ファイル形式", "BAK ファイルの種類", "BAK ファイルの拡張子", "データベース ファイルの種類", "データベース ファイル形式", "データベース ファイル" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"BAK ファイルの形式と,BAK ファイルを作成して開くことができる API について学びます。",
  "title" :"BAKファイル形式 - データベースバックアップファイル",
  "linktitle" : "BAK",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-12-04"
}

## .BAK オプション番号

拡張子が .bak のファイルは通常、さまざまなソフトウェア ツールでデータのバックアップを保存するために使用されるバックアップ ファイルです。データベースの観点から見ると、BAK ファイルはデータベースの内容を格納するために Microsoft SQL Server によって使用されます。データベースに関連付けられたすべてのデータとファイルは、このファイル形式で保存され、何らかの理由でデータベースが破損または無効になった場合に取得できます。安全のために、バックアップ ファイルを他のサーバーに保存してインデックスを作成することができます。 SQL Server Management Studio、Transact-SQL、Windows PowerShell など、いくつかのアプリケーションで BAK ファイルを作成できます。

## BAK ファイル形式

BAK ファイルの内部の詳細は不明ですが、Microsoft Tape Format (MTF) に基づいていると広く考えられています。 MTF 仕様が利用可能であり、ファイルの構造を理解するために参照できます。このドキュメントでは、ストレージ管理操作、テープ ドライブ、およびファイル システムに関する一般的な知識を持つすべてのユーザー向けに、MTF ストレージの詳細を説明します。

### データセット

データセットは、データのバックアップまたは復元中にストレージ メディア (テープ、光ディスクなど) に書き込まれるオブジェクトのコレクションです。大量のデータの場合、データセットは複数のメディアで構成されます。

### MTFの基本要素

MTF ファイルは、そのビルディング ブロックを構成するいくつかの基本的な要素で構成されています。これらの要素は次のとおりです。

#### 記述子ブロック

記述子ブロック (DBLK) はフォーマット制御に使用され、MTF ファイルの主要な基盤を構成します。 1 つの MTF ファイルで、一意のロールごとに複数の DBLK が定義されます。各 DBLK は可変長のデータ ブロックであり、次の 4 つの部分に分割されます。

* `Common Block Header` - すべての DBLK に共通の固定長構造。これは、必要な唯一のブロック ヘッダーです。
* `DBLK Type Information` - 定義されている DBLK のタイプに固有の固定長ブロック
* 「オペレーティング システム データ」 - DBLK のタイプとオペレーティング システムに基づいて定義される特定のデータ
* `DBLK 情報` - 固定長 DBLK 情報では保存できない可変長 DBLK 固有の情報。

 {{< figure src="../bak.png" alt="Microsoft SQL バックアップ ファイル形式" >}}

＃＃＃＃ データストリーム

MTF ファイルのデータ ストリームは、データのカプセル化と配置に使用されます。これは、ストリーム ヘッダーとそれに続くストリーム データで構成されます。ストリーム ヘッダーは、1 種類のストリーム データのみをカプセル化できます。

{{< figure src="../bak_datastream.png" alt="Microsoft SQL バックアップ ファイル形式" >}}

#### ファイルマーク

ファイルマークは、メディア内での論理的な分離と迅速なアクセスに使用されます。ファイルマークは、使用中のデバイスがファイルマークを提供しない場合、デバイス ドライバーまたはソフト ファイルマーク記述子ブロックを使用してエミュレートされます。

## 参照 ##

* [[MS-BCP]: 一括コピー形式](https://learn.microsoft.com/en-us/openspecs/sql_data_portability/ms-bcp/54965c4d-34c7-400d-b970-1007984315a5?redirectedfrom=MSDN)

