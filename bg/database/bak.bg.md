{
  "date" : "2020-11-11",
  "keywords" :[ "BAK", "разширение", "файл", "файлов формат", "BAK файлов тип", "BAK файлово разширение", "Файлов тип на база данни", "Файлов формат на база данни", "Файлове на база данни"],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"Научете за файловия формат BAK и API, които могат да създават и отварят BAK файлове.",
  "title" :"BAK файлов формат – архивен файл на база данни",
  "linktitle" : "BAK",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-12-04"
}

## Какво е BAK файл?

Файл с разширение .bak обикновено е архивен файл, който се използва от различни софтуерни инструменти за съхраняване на резервни копия на данни. От гледна точка на база данни, BAK файл се използва от Microsoft SQL Server за съхраняване на съдържанието на база данни. Всички данни и файлове, свързани с базата данни, се съхраняват в този файлов формат, за да бъдат извлечени в случай, че базата данни може да стане повредена или невалидна по някаква причина. Архивните файлове могат да се съхраняват и индексират на други сървъри с цел безопасност. Няколко приложения могат да създават BAK файлове като SQL Server Management Studio, Transact-SQL и Windows PowerShell.

## BAK файлов формат

Вътрешните подробности за BAK файл не са известни, но се предполага, че той е базиран на Microsoft Tape Format (MTF). Спецификациите на MTF са налични и могат да бъдат използвани за справка за разбиране на структурата на файла. Документът предоставя подробности относно MTF съхранението за всеки, който има общи познания относно операциите за управление на съхранението, лентовите устройства и файловите системи.

### Набори от данни

Набор от данни е колекция от обекти, записани на носител за съхранение (лента, оптичен диск и т.н.) по време на архивиране или възстановяване на данни. Наборите от данни се състоят от множество носители в случай на голям обем данни.

### Основни елементи на MTF

MTF файлът се състои от някои основни елементи, които представляват неговите градивни елементи. Тези елементи са:

#### Дескрипторни блокове

Дескрипторните блокове (DBLK) се използват за контрол на формата и съставляват основните основи на MTF файл. Един MTF файл дефинира множество DBLK за всяка уникална роля. Всеки DBLK е блок от данни с променлива дължина, който е разделен на следните четири части:

* `Common Block Header` - Структура с фиксирана дължина, която е обща за всички DBLK. Това е единственият заглавен блок, който се изисква.
* `Информация за типа на DBLK` - Блок с фиксирана дължина, специфичен за типа на дефинирания DBLK
* `Данни за операционната система` - Конкретни данни, които се дефинират въз основа на типа DBLK и операционни системи
* `Информация за DBLK` - Специфична информация за DBLK с променлива дължина, която не може да бъде записана с информацията за DBLK с фиксирана дължина.

 {{< figure src="../bak.png" alt="Файлов формат за архивиране на Microsoft SQL" >}}

#### Поток от данни

Потоците от данни в MTF файл се използват за капсулиране и подравняване на данни. Състои се от заглавка на потока, последвана от данните за потока. Заглавката на потока може да капсулира само един тип данни на потока.

{{< figure src="../bak_datastream.png" alt="Файлов формат за архивиране на Microsoft SQL" >}}

#### FileMarks

Файловият знак се използва за логическо разделяне и бърз достъп в медия. Файловите марки се емулират от драйвера на устройството или чрез използване на блока Soft Filemark Descriptor в случай, че използваното устройство не предоставя файлови марки.

## Препратки ##

* [[MS-BCP]: Формат за групово копиране](https://learn.microsoft.com/en-us/openspecs/sql_data_portability/ms-bcp/54965c4d-34c7-400d-b970-1007984315a5?redirectedfrom=MSDN)

