{
  "date" : "2020-11-11",
  "keywords" :[ "BAK", "расширение", "файл", "формат файла", "Тип файла BAK", "Расширение файла BAK", "Тип файла базы данных", "Формат файла базы данных", "Файлы базы данных" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"Узнайте о формате файла BAK и API-интерфейсах, которые могут создавать и открывать файлы BAK.",
  "title" :"Формат файла BAK — файл резервной копии базы данных",
  "linktitle" : "BAK",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-12-04"
}

## .BAK вариант №

Файл с расширением .bak обычно представляет собой файл резервной копии, который используется различными программными инструментами для хранения резервных копий данных. С точки зрения базы данных файл BAK используется Microsoft SQL Server для хранения содержимого базы данных. Все данные и файлы, связанные с базой данных, хранятся в этом формате файлов для извлечения в случае, если база данных может быть повреждена или недействительна по какой-либо причине. Файлы резервных копий могут храниться и индексироваться на других серверах в целях безопасности. Некоторые приложения могут создавать файлы BAK, такие как SQL Server Management Studio, Transact-SQL и Windows PowerShell.

## Формат файла BAK

Внутренние детали файла BAK неизвестны, но широко распространено мнение, что он основан на формате Microsoft Tape Format (MTF). Спецификации MTF доступны, и на них можно ссылаться для понимания структуры файла. Документ содержит подробные сведения о хранилище MTF для всех, кто имеет общие знания об операциях управления хранением, ленточных накопителях и файловых системах.

### Наборы данных

Набор данных — это набор объектов, записываемых на носитель (ленту, оптический диск и т. д.) во время резервного копирования или восстановления данных. Наборы данных состоят из нескольких носителей в случае большого объема данных.

### Фундаментальные элементы MTF

Файл MTF состоит из некоторых основных элементов, составляющих его строительные блоки. Эти элементы:

#### Блоки дескрипторов

Блоки дескрипторов (DBLK) используются для управления форматом и составляют основную основу файла MTF. Один файл MTF определяет несколько DBLK для каждой уникальной роли. Каждый DBLK представляет собой блок данных переменной длины, который разделен на следующие четыре части:

* «Общий заголовок блока» — структура фиксированной длины, общая для всех DBLK. Это единственный необходимый заголовок блока.
* «Информация о типе DBLK» — блок фиксированной длины, характерный для определяемого типа DBLK.
* «Данные операционной системы» — конкретные данные, которые определяются на основе типа DBLK и операционных систем.
* «Информация DBLK» — специальная информация DBLK переменной длины, которую нельзя сохранить вместе с информацией DBLK фиксированной длины.

 {{< figure src="../bak.png" alt="Формат файла резервной копии Microsoft SQL" >}}

#### Поток данных

Потоки данных в файле MTF используются для инкапсуляции и выравнивания данных. Он состоит из заголовка потока, за которым следуют данные потока. Заголовок потока может инкапсулировать только один тип данных потока.

{{< figure src="../bak_datastream.png" alt="Формат файла резервной копии Microsoft SQL" >}}

#### Метки файлов

Метка файла используется для логического разделения и быстрого доступа к медиафайлу. Метки файлов эмулируются драйвером устройства или с помощью блока Soft Filemark Descriptor, если используемое устройство не предоставляет файловые метки.

## Использованная литература ##

* [[MS-BCP]: формат массового копирования](https://learn.microsoft.com/en-us/openspecs/sql_data_portability/ms-bcp/54965c4d-34c7-400d-b970-1007984315a5)

