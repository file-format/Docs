{
  "date" : "2020-11-11",
  "keywords" :[ "MDF", "นามสกุล", "ไฟล์", "รูปแบบไฟล์", "ประเภทไฟล์ฐานข้อมูล", "รูปแบบไฟล์ฐานข้อมูล", "ไฟล์ฐานข้อมูล" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"เรียนรู้เกี่ยวกับรูปแบบไฟล์ MDF และ API ที่สามารถสร้างและเปิดไฟล์ MDF",
  "title" :"รูปแบบไฟล์ MDF - ไฟล์ฐานข้อมูลหลักของเซิร์ฟเวอร์ SQL",
  "linktitle" : "MDF",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-08-12"
}

## ไฟล์ MDF คืออะไร??

ไฟล์ที่มีนามสกุล .mdf คือไฟล์ฐานข้อมูลหลักที่ [Microsoft SQL Server](https://en.wikipedia.org/wiki/Microsoft_SQL_Server) ใช้เพื่อเก็บข้อมูลผู้ใช้ มีความสำคัญอย่างยิ่งเนื่องจากข้อมูลทั้งหมดถูกจัดเก็บไว้ในไฟล์นี้ ไฟล์ MDF เก็บข้อมูลผู้ใช้ในฐานข้อมูลเชิงสัมพันธ์ในรูปแบบคอลัมน์ แถว ฟิลด์ ดัชนี มุมมอง และตาราง SQL Server อนุญาตให้ตั้งค่า autogrow และ autoshrink เพื่อให้มีผลในเชิงบวกต่อประสิทธิภาพของฐานข้อมูล ไฟล์ MDF สามารถโหลดและแนบกับฐานข้อมูลโดยใช้ Microsoft SQL Server ไฟล์ MDF มีประเภท MIME ของ Application/octet-stream

## รูปแบบไฟล์ MDF

หน่วยพื้นฐานของการจัดเก็บข้อมูลใน SQL Server คือหน้า เพจพื้นที่เก็บข้อมูลที่กำหนดฐานข้อมูลแบ่งออกเป็นเพจตรรกะที่มีหมายเลขตั้งแต่ 0 ถึง n หน้าเดียวเริ่มต้นด้วยส่วนหัว 96 ไบต์ที่ประกอบด้วย ID ของหน้า ประเภทของโครงสร้างที่เป็นของหน้า จำนวนระเบียนในหน้า และตัวชี้ไปยังหน้าที่แล้วและหน้าถัดไป

### โครงสร้างไฟล์

ไฟล์ MDF มีโครงสร้างข้อมูลดังต่อไปนี้

* หน้า 0: ส่วนหัว
* หน้า 1: PFS แรก
* หน้า 2: เกมแรก
* หน้า 3: SGAM แรก
* หน้า 4: ไม่ได้ใช้
* หน้า 5: ไม่ได้ใช้
* หน้า 6: DCM แรก
* หน้า 7: BCM แรก

#### ส่วนหัวของไฟล์

หมายเลขหน้า 0 ของไฟล์ทั้งหมดมีส่วนหัวที่เก็บข้อมูลเมตาเกี่ยวกับไฟล์

#### พื้นที่ว่างของหน้า (PFS)
PFS ระบุสถานะการจัดสรรและกำหนดจำนวนพื้นที่ว่าง

* บิต 1: ระบุว่าหน้าได้รับการจัดสรรหรือไม่
* บิต 2: ระบุว่าหน้ามาจากหลายขอบเขตหรือไม่
* บิต 3: ระบุว่าหน้านี้เป็นหน้า IAM
* บิต 4: ระบุว่าหน้านี้มีบันทึกผี
* บิต 5 ถึง 7: ค่าสามบิตรวมกัน ซึ่งระบุความสมบูรณ์ของหน้าดังนี้:
* 0: หน้าว่างเปล่า
* 1: หน้าเต็ม 1–50%
* 2: หน้าเต็ม 51–80%
* 3: หน้าเต็ม 81–95%
* 4: หน้าเต็ม 96–100%

## อ้างอิง

* [ไฟล์ฐานข้อมูลและกลุ่มไฟล์](https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-files-and-filegroups?view=sql-server-ver15)
* [แยกและแนบฐานข้อมูล - SQL Server](https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-detach-and-attach-sql-server?view=sql-server -ver15)
* [การวิเคราะห์กายวิภาคของไฟล์ข้อมูล SQL Server](https://blog.pythian.com/analyzing-sql-server-data-file-anatomy/)

