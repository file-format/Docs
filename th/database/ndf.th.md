{
  "date" : "2020-11-11",
  "keywords" :[ "NDF", "นามสกุล", "ไฟล์", "รูปแบบไฟล์", "ประเภทไฟล์ฐานข้อมูล", "รูปแบบไฟล์ฐานข้อมูล", "ไฟล์ฐานข้อมูล" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"เรียนรู้เกี่ยวกับรูปแบบไฟล์ MDF และ API ที่สามารถสร้างและเปิดไฟล์ NDF",
  "title" :"รูปแบบไฟล์ NDF - ไฟล์ฐานข้อมูลหลักของเซิร์ฟเวอร์ SQL",
  "linktitle" : "NDF",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-08-12"
}

## ไฟล์ NDF คืออะไร??

ไฟล์ที่มีนามสกุล .ndf เป็นไฟล์ฐานข้อมูลรองที่ [Microsoft SQL Server](https://en.wikipedia.org/wiki/Microsoft_SQL_Server) ใช้เพื่อเก็บข้อมูลผู้ใช้ NDF เป็นไฟล์ที่เก็บข้อมูลสำรองเนื่องจากเซิร์ฟเวอร์ SQL เก็บข้อมูลที่ผู้ใช้ระบุในไฟล์ที่เก็บข้อมูลหลักที่เรียกว่า [MDF](/th/database/mdf/) ไฟล์ข้อมูล NDF เป็นทางเลือกและกำหนดโดยผู้ใช้เพื่อจัดการพื้นที่จัดเก็บข้อมูลในกรณีที่ไฟล์ MDF หลักใช้พื้นที่ที่จัดสรรทั้งหมด โดยปกติจะจัดเก็บไว้ในดิสก์แยกต่างหากและสามารถแพร่กระจายไปยังอุปกรณ์เก็บข้อมูลหลายเครื่อง จำเป็นต้องมีไฟล์ MDF เพื่อเปิดไฟล์ NDF

## รูปแบบไฟล์ NDF

รูปแบบไฟล์ NDF ไม่ต่างจาก [MDF](/th/database/mdf/) และใช้หน้าเป็นหน่วยพื้นฐานของการจัดเก็บข้อมูล แต่ละหน้าเริ่มต้นด้วยส่วนหัว 96 ไบต์ซึ่งประกอบด้วย:

* รหัสหน้า
* ประเภทของโครงสร้าง
* จำนวนบันทึกในหน้า
* ตัวชี้ไปยังหน้าที่แล้วและหน้าถัดไป

### โครงสร้างไฟล์ NDF

ไฟล์ MDF มีโครงสร้างข้อมูลดังต่อไปนี้

* หน้า 0: ส่วนหัว
* หน้า 1: PFS แรก
* หน้า 2: เกมแรก
* หน้า 3: SGAM แรก
* หน้า 4: ไม่ได้ใช้
* หน้า 5: ไม่ได้ใช้
* หน้า 6: DCM แรก
* หน้า 7: BCM แรก

#### ส่วนหัวของไฟล์ NDF

หมายเลขหน้า 0 ของไฟล์ทั้งหมดมีส่วนหัวที่เก็บข้อมูลเมตาเกี่ยวกับไฟล์

#### พื้นที่ว่างของหน้า (PFS)
PFS ระบุสถานะการจัดสรรและกำหนดจำนวนพื้นที่ว่าง

* บิต 1: ระบุว่าหน้าได้รับการจัดสรรหรือไม่
* บิต 2: ระบุว่าหน้ามาจากหลายขอบเขตหรือไม่
* บิต 3: ระบุว่าหน้านี้เป็นหน้า IAM
* บิต 4: ระบุว่าหน้านี้มีบันทึกผี
* บิต 5 ถึง 7: ค่าสามบิตรวมกัน ซึ่งระบุความสมบูรณ์ของหน้าดังนี้:
* 0: หน้าว่างเปล่า
* 1: หน้าเต็ม 1–50%
* 2: หน้าเต็ม 51–80%
* 3: หน้าเต็ม 81–95%
* 4: หน้าเต็ม 96–100%

## หน้าไฟล์ข้อมูล

หน้าในไฟล์ข้อมูล SQL Server เริ่มต้นจากศูนย์ (0) และเพิ่มขึ้นตามลำดับ แต่ละไฟล์จะถูกจดจำด้วยหมายเลข ID ของไฟล์ที่ไม่ซ้ำกัน รหัสไฟล์และหมายเลขหน้าคู่ระบุหน้าในฐานข้อมูลโดยไม่ซ้ำกัน ตัวอย่างการแสดงหมายเลขหน้าในฐานข้อมูลดังภาพต่อไปนี้

{{< figure src="../ndf.png" alt="รูปแบบไฟล์ฐานข้อมูล NDF" >}}

ตัวอย่างนี้แสดงหมายเลขหน้าในฐานข้อมูลที่มีไฟล์ข้อมูลหลักขนาด 4 MB และไฟล์ข้อมูลรองขนาด 1 MB

## อ้างอิง

* [ไฟล์ฐานข้อมูลและกลุ่มไฟล์](https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-files-and-filegroups?view=sql-server-ver16)
* [แยกและแนบฐานข้อมูล - SQL Server](https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-detach-and-attach-sql-server?view=sql-server-ver15)
* [การวิเคราะห์กายวิภาคของไฟล์ข้อมูล SQL Server](https://blog.pythian.com/analyzing-sql-server-data-file-anatomy/)

