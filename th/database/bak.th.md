{
  "date" : "2020-11-11",
  "keywords" :[ "BAK", "นามสกุล", "ไฟล์", "รูปแบบไฟล์", "ประเภทไฟล์ BAK", "นามสกุลไฟล์ BAK", "ประเภทไฟล์ฐานข้อมูล", "รูปแบบไฟล์ฐานข้อมูล", "ไฟล์ฐานข้อมูล" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"เรียนรู้เกี่ยวกับรูปแบบไฟล์ BAK และ API ที่สามารถสร้างและเปิดไฟล์ BAK",
  "title" :"รูปแบบไฟล์ BAK - ไฟล์สำรองฐานข้อมูล",
  "linktitle" : "BAK",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-12-04"
}

## ไฟล์ BAK คืออะไร??

ไฟล์ที่มีนามสกุล .bak มักจะเป็นไฟล์สำรองที่เครื่องมือซอฟต์แวร์ต่างๆ ใช้เพื่อจัดเก็บข้อมูลสำรอง จากมุมมองของฐานข้อมูล Microsoft SQL Server จะใช้ไฟล์ BAK เพื่อจัดเก็บเนื้อหาของฐานข้อมูล ข้อมูลและไฟล์ทั้งหมดที่เกี่ยวข้องกับฐานข้อมูลจะถูกจัดเก็บในรูปแบบไฟล์นี้เพื่อเรียกค้นข้อมูลในกรณีที่ฐานข้อมูลอาจเสียหายหรือไม่ถูกต้องไม่ว่าด้วยเหตุผลใดก็ตาม ไฟล์สำรองสามารถจัดเก็บและจัดทำดัชนีบนเซิร์ฟเวอร์อื่นเพื่อความปลอดภัย แอปพลิเคชั่นหลายตัวสามารถสร้างไฟล์ BAK เช่น SQL Server Management Studio, Transact-SQL และ Windows PowerShell

## รูปแบบไฟล์ BAK

รายละเอียดภายในของไฟล์ BAK ไม่เป็นที่รู้จัก แต่สันนิษฐานกันอย่างกว้างขวางว่าไฟล์นั้นอ้างอิงจาก Microsoft Tape Format (MTF) มีข้อกำหนดเฉพาะของ MTF และสามารถอ้างอิงเพื่อทำความเข้าใจโครงสร้างของไฟล์ได้ เอกสารนี้ให้รายละเอียดเกี่ยวกับพื้นที่จัดเก็บ MTF สำหรับทุกคนที่มีความรู้ทั่วไปเกี่ยวกับการดำเนินการจัดการพื้นที่จัดเก็บ เทปไดร์ฟ และระบบไฟล์

### ชุดข้อมูล

ชุดข้อมูลคือชุดของวัตถุที่เขียนลงในสื่อบันทึกข้อมูล (เทป ออปติคัลดิสก์ ฯลฯ) ระหว่างการสำรองหรือกู้คืนข้อมูล ชุดข้อมูลประกอบด้วยหลายสื่อในกรณีที่ข้อมูลมีปริมาณมาก

### องค์ประกอบพื้นฐานของ MTF

ไฟล์ MTF ประกอบด้วยองค์ประกอบพื้นฐานบางอย่างที่ประกอบกันเป็นหน่วยการสร้าง องค์ประกอบเหล่านี้คือ:

#### บล็อกคำอธิบาย

Descriptor Blocks (DBLK) ใช้สำหรับควบคุมรูปแบบและเป็นพื้นฐานหลักของไฟล์ MTF ไฟล์ MTF ไฟล์เดียวกำหนด DBLK หลายรายการสำหรับแต่ละบทบาทที่ไม่ซ้ำกัน DBLK แต่ละชุดเป็นบล็อกความยาวผันแปรของข้อมูลที่แบ่งออกเป็นสี่ส่วนต่อไปนี้:

* `Common Block Header` - โครงสร้างความยาวคงที่ที่ใช้ร่วมกันกับ DBLK ทั้งหมด นี่เป็นส่วนหัวบล็อกเดียวที่จำเป็น
* `ข้อมูลประเภท DBLK` - บล็อกความยาวคงที่เฉพาะสำหรับประเภทของ DBLK ที่กำหนด
* `Operating System Data` - ข้อมูลเฉพาะที่กำหนดตามประเภทของ DBLK และระบบปฏิบัติการ
* `ข้อมูล DBLK` - ข้อมูลเฉพาะของ DBLK ที่มีความยาวผันแปรซึ่งไม่สามารถบันทึกได้ด้วยข้อมูล DBLK ที่มีความยาวคงที่

 {{< figure src="../bak.png" alt="รูปแบบไฟล์สำรอง Microsoft SQL" >}}

#### กระแสข้อมูล

สตรีมข้อมูลในไฟล์ MTF ใช้สำหรับการห่อหุ้มและการจัดตำแหน่งข้อมูล ประกอบด้วย Stream Header ตามด้วย Stream Data ส่วนหัวของสตรีมสามารถสรุปข้อมูลสตรีมได้เพียงประเภทเดียวเท่านั้น

{{< figure src="../bak_datastream.png" alt="รูปแบบไฟล์สำรอง Microsoft SQL" >}}

#### FileMarks

เครื่องหมายไฟล์ใช้สำหรับการแยกทางตรรกะและการเข้าถึงอย่างรวดเร็วภายในสื่อ Filemarks จำลองโดยโปรแกรมควบคุมอุปกรณ์หรือโดยการใช้บล็อก Soft Filemark Descriptor ในกรณีที่อุปกรณ์ที่ใช้ไม่มี filemarks

## อ้างอิง ##

* [[MS-BCP]: รูปแบบการคัดลอกจำนวนมาก](https://learn.microsoft.com/en-us/openspecs/sql_data_portability/ms-bcp/54965c4d-34c7-400d-b970-1007984315a5?redirectedfrom=MSDN)

