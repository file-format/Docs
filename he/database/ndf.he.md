{
  "date" : "2020-11-11",
  "keywords" :[ "NDF", "הרחבה", "קובץ", "פורמט קובץ", "סוג קובץ מסד נתונים", "פורמט קובץ מסד נתונים", "קבצי מסד נתונים" ],
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "description" :"למד על פורמט קובץ MDF וממשקי API שיכולים ליצור ולפתוח קובצי NDF.",
  "title" :"פורמט קובץ NDF - קובץ מסד הנתונים הראשי של SQL Server",
  "linktitle" : "NDF",
  "menu" : {
    "docs" : {
      "parent" : "database"
}
},
  "lastmod" : "2020-08-12"
}

## מהו קובץ NDF?

קובץ עם סיומת .ndf הוא קובץ מסד נתונים משני המשמש את [Microsoft SQL Server](https://en.wikipedia.org/wiki/Microsoft_SQL_Server) לאחסון נתוני משתמש. NDF הוא קובץ אחסון משני מכיוון ששרת SQL מאחסן נתונים שצוינו על ידי המשתמש בקובץ האחסון הראשי המכונה [MDF](/he/database/mdf/). קובץ נתוני NDF הוא אופציונלי ומוגדר על ידי המשתמש לניהול אחסון נתונים במקרה שקובץ ה-MDF הראשי משתמש בכל השטח שהוקצה. זה מאוחסן בדרך כלל בדיסק נפרד ויכול להתפשט למספר התקני אחסון. נוכחותם של קבצי MDF נחוצה על מנת לפתוח קבצי NDF.

## פורמט קובץ NDF

פורמט קובץ NDF אינו שונה מ-[MDF](/he/database/mdf/) ומשתמש בדפים כיחידה הבסיסית של אחסון נתונים. כל עמוד מתחיל בכותרת של 96 בתים הכוללת:

* מזהה עמוד
* סוג המבנה
* מספר רשומות בדפים
* מצביעים לעמודים הקודמים והבאים

### מבנה קובץ NDF

לקובץ MDF יש את מבנה הנתונים הבא.

* עמוד 0: כותרת עליונה
* עמוד 1: PFS ראשון
* עמוד 2: GAM ראשון
* עמוד 3: SGAM ראשון
* עמוד 4: לא בשימוש
* עמוד 5: לא בשימוש
* עמוד 6: DCM ראשון
* עמוד 7: BCM ראשון

#### כותרת קובץ NDF

העמוד מספר 0 של כל הקבצים מכיל כותרת שמאחסנת מטא נתונים על הקובץ.

#### דף פנוי (PFS)
PFS מזהה את מצב ההקצאה וקובע את כמות השטח הפנוי.

* Bit 1: מציין אם הדף מוקצה או לא.
* סיביות 2: מציינת אם הדף הוא בהיקף מעורב.
* ביט 3: מציין שדף זה הוא דף IAM.
* סיביות 4: מציינת שדף זה מכיל רשומות רפאים
* סיביות 5 עד 7: ערך משולב של שלוש סיביות, המציין את מלאות העמוד באופן הבא:
* 0: הדף ריק
* 1: הדף מלא ב-1-50%.
* 2: העמוד מלא ב-51-80%.
* 3: העמוד מלא ב-81–95%.
* 4: העמוד מלא ב-96-100%.

## דף קובץ נתונים

דפים בקובץ נתונים של SQL Server מתחילים מאפס (0) ומתגברים ברצף. כל קובץ מזוהה על ידי מספר מזהה קובץ ייחודי. מזהה הקובץ וצמד מספרי העמודים מזהים באופן ייחודי עמוד במסד נתונים. דוגמה להצגת מספרי עמודים במסד נתונים, היא כמו בתמונה הבאה.

{{< figure src="../ndf.png" alt="פורמט קובץ מסד נתונים NDF" >}}

דוגמה זו מציגה מספרי עמודים במסד נתונים שיש לו קובץ נתונים ראשוני של 4MB וקובץ נתונים משני של 1MB.

## הפניות

* [קבצי מסד נתונים וקבוצות קבצים](https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-files-and-filegroups?view=sql-server-ver16)
* [נתק וצרף מסד נתונים - SQL Server](https://learn.microsoft.com/en-us/sql/relational-databases/databases/database-detach-and-attach-sql-server?view=sql-server -ver15)
* [ניתוח SQL Server Data File Anatomy](https://blog.pythian.com/analyzing-sql-server-data-file-anatomy/)

