{
  "date" : "2019-10-11",
  "author" : {
    "display_name" : "Kashif Iqbal"
},
  "draft" : "false",
  "toc" : true,
  "title" :"TNEF",
  "description":"למד על פורמט קובץ TNEF וממשקי API שיכולים ליצור ולפתוח קבצי TNEF.",
  "linktitle" : "TNEF",
  "menu" : {
    "docs" : {
      "parent" : "email"
}
},
  "lastmod" : "2019-09-10"
}

## מהו קובץ TNEF?

Transport Neutral Encapsulation Format (TNEF) הוא מוצר קנייני של מיקרוסופט, ללקיחת קבצים מצורפים לדואר אלקטרוני המבוסס על ממשק תכנות יישומי הודעות (**MAPI**). Microsoft Outlook ו-Microsoft Exchange Server, תומכים לחלוטין ב-TNEF בעוד מאוחר יותר מפענחים את TNEF ל-MAPI ומציגים את האימיילים המעוצבים. לקובץ מצורף לדוא"ל עם קידוד TNEF יש סוג MIME של MS-TNEF והוא מאוחסן כ-winmail/win.dat. הקובץ המצורף ב-winmail .dat מקיף את המידע הבא:


|הודעה|אובייקטי OLE|תכונות Outlook
---|---|---|
|<ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> קבצים מצורפים להודעה מקורית</li><li style=";text-align:right;direction:rtl"> גרסה מקורית בפורמט</li><li style=";text-align:right;direction:rtl"> גופנים, גדלי טקסט וצבעי טקסט</li></ul> |<ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> תמונות מוטבעות</li><li style=";text-align:right;direction:rtl"> מסמכי Office משובצים</li></ul> |<ul style=";text-align:right;direction:rtl"><li style=";text-align:right;direction:rtl"> טפסים מותאמים אישית</li><li style=";text-align:right;direction:rtl"> כפתורי הצבעה</li><li style=";text-align:right;direction:rtl"> בקשות לפגישה</li></ul>


שירותי דואר אלקטרוני אחרים שאינם תומכים ב-TNEF, מציגים טקסט רגיל עבור הודעות בפורמט TNEF. Outlook מטמיע פורמט עשיר של ההודעה בקובצי TNEF (OLE) או בתכונות מסוימות של Outlook (טפסים, לחצני סקר ובקשות לועידה). סנקציה של קידוד TNEF מפורש בתוך לקוח הדואר האלקטרוני של Outlook אינו אפשרי, עם זאת, בחירה בפורמט RTF לשליחת דואר אלקטרוני מקלה באופן מרומז על קידוד TNEF.

## פורמט קובץ TNEF

אלגוריתם הנתונים TNEF קובע מבנה שטוח ממאפייני מסרים היררכיים עשירים. המבנים הפחוסים האלה משמשים אז כדי לייצג זרם נתונים סדרתי המורכב ממאפיינים מסוימים.

במצבים מסוימים, שבהם מאפיינים מופיעים בקבוצות או בעלי מספר ערכים, הזרם עשוי לכלול ספירות וריפודים כדי לאכוף יישור נתונים ספציפי. מצב ייחודי שבו השימוש באלגוריתם זה הוא יתרון הוא בסביבת מסרים לא תומכת. בסביבות כאלה, מאפיין הודעה עשיר מקודד לזרם נתונים סדרתי על ידי סופר TNEF. יתר על כן, המאפיינים שאינם שייכים ל-TNEF הבסיסי יכולים להיות מובלעים במהלך השידור. המאפיינים המובלעים הללו הופנו לזמינים לאחר מכן על ידי פענוח דרך TNEF כדי להבטיח את הזמינות של כל המאפיינים של ההודעה המקורית ליישום הלקוח.

ב-TNEF כל סוגי הנתונים המספריים הם מעט-אנדיאנים וגודלם גדול מבייט אחד. טיפול בערכים מספריים אלה בפלטפורמות שאינן אנדיאניות קטנות מחייב לבצע את הטרנספורמציות המתאימות כדי לקבל ערכים נכונים. ערכי מחרוזת מיוצגים בפורמט Augmented Backus-Naur Form (ABNF) לפי מפרטי [RFC5234]. כאשר המחרוזת מסתיימת עם תו ריק, היא נכללת גם כן; לדוגמה, "worker@specimen.com" %x00.

{{< figure src="../TNEF.png" alt="פורמט קובץ TNEF" >}}

## תכונות TNEF וכללי עיבוד ##

זרם הנתונים ב-TNEF מתחיל עם מספר גרסה מדור קודם, חתימה, ערך מפתח פרימיטיבי ותכונה מייצגת דף קוד. דף קוד זה נוצר כאשר המקודד מתעד תכונות ומאפיינים של ANSI. לאחר מכן, הזרם הפך לסדרה של תכונות שבהן תכונות ההודעה מופיעות בשורה ראשונה ואחריהן תכונות מצורף. מאפיינים שונים של הודעות וקבצים מצורפים כלולים בתכונות מיוחדות כמו attMsgProps, attAttachment ו-attRecipTable. התכונות המופיעות בזרם TNEF, מכילות את המבנה, מאפייני ההודעה וההמרות הנחוצות כדי להפעיל אותם עם מאפייני ההודעה. כל תכונה מורכבת מזהה, גודל ונתונים של התכונה, סכום ביקורת ורמה בהתאם ליישום שלה.

## קשר לפרוטוקולים ואלגוריתמים אחרים ##

המערכות שיש להן מנגנון לקוי להצגת פורמט הודעות עשיר זקוקות באופן מקורי לאלגוריתם נתונים TNEF להעברה. באמצעות סוג המדיה ms-TNEF, הפלט של האלגוריתם מורכב מקובץ מצורף (winmail.dat) וחלק גוף של MIME שצוין ב-[RFC2045]. גוף הודעת הטקסט הפשוט מועבר באמצעות UUENCODE לפי מפרט [MSDN-UAF] וגוף ההודעה הזו או שיטה מקבילה מפוענחים בקצה הנמען. יתר על כן, TNEF יכול להעביר נתוני הודעות באמצעות פרוטוקולי אינטרנט שונים כמו SMTP, POP3, IMAP4, ואלה, לשלב MIME לפי תקן RFC2045.

## הצהרת תחולה ##

בנוסף להעברת הודעות פשוטה, האפליקציה המקורית של TNEF הייתה אמורה להיווצר כדי להשתמש במחלקות הודעות ולתמוך בתכונות נוספות שאין להן תמיכה מקורית בפרוטוקול התעבורה. יישום זה שוכלל עוד יותר עבור שידור של מאפייני הודעות עשירים ומאפיינים בעלי שם שלקוחות העברת הודעות מודרניים משתמשים בהם כיום. לעמידה ביישום המקורי, תחביר התכונה המקורי נשמר ותכונה מיוחדת מחזיקה בנפרד את מאפייני ההודעה החדשה.

## הפניות

* [Transport Neutral Encapsulation Format](https://en.wikipedia.org/wiki/Transport_Neutral_Encapsulation_Format)
* [כתובות אימייל ופנקסי כתובות ב-Exchange Server](https://learn.microsoft.com/en-us/exchange/email-addresses-and-address-books/email-addresses-and-address-books?view# exchserver-2019)
* [[MS-OXTNEF]: אלגוריתם נתונים של תחבורה ניטרלי אנקפסולציה (TNEF)](https://msdn.microsoft.com/en-us/library/cc425498(v#exchg.80).aspx)

